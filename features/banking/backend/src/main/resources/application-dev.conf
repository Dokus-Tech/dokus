ktor {
    deployment {
        port = 7097
        port = ${?PORT}
        host = "0.0.0.0"
        host = ${?HOST}
        environment = "development"
        environment = ${?ENVIRONMENT}
    }

    application {
        modules = [ ai.dokus.banking.backend.ApplicationKt.module ]
    }
}

# Database config
database {
    url = "jdbc:postgresql://localhost:5432/dokus_banking"
    url = ${?DB_URL}
    username = "dev"
    username = ${?DB_USERNAME}
    password = "devpassword"
    password = ${?DB_PASSWORD}

    pool {
        maxSize = 20
        minSize = 5
        acquisitionTimeout = 30
        idleTimeout = 600
        maxLifetime = 1800
        leakDetectionThreshold = 30
    }
}

# Flyway config
flyway {
    enabled = false
    baselineOnMigrate = false
    baselineVersion = "1.0.0"
    locations = []
    schemas = ["public"]
}

# JWT config (not used by banking service)
jwt {
    issuer = "https://dokus.ai"
    audience = "dokus-api"
    realm = "Access to Dokus API"
    secret = "unused"
    algorithm = "HS256"
}

# Auth config (not used by banking service)
auth {
    maxLoginAttempts = 5
    lockDurationMinutes = 30
    sessionDurationHours = 8
    rememberMeDurationDays = 30
    maxConcurrentSessions = 3

    password {
        expiryDays = 90
        minLength = 10
        requireUppercase = true
        requireLowercase = true
        requireDigits = true
        requireSpecialChars = true
        historySize = 5
    }

    rateLimit {
        windowSeconds = 60
        maxAttempts = 10
    }

    enableDeviceFingerprinting = false
    enableSessionSlidingExpiration = false
    sessionActivityWindowMinutes = 15
    logSecurityEvents = false
    enableDebugMode = false
}

logging {
    level = "INFO"
    level = ${?LOG_LEVEL}
    consoleJson = false
    consoleJson = ${?LOG_CONSOLE_JSON}
}

metrics {
    enabled = true
    enabled = ${?METRICS_ENABLED}
    prometheusPath = "/metrics"
    prometheusPath = ${?METRICS_PROMETHEUS_PATH}
}

security {
    cors {
        allowedHosts = ["localhost:6061", "10.13.4.103:6060"]
        allowedHosts = ${?SECURITY_CORS_ALLOWED_HOSTS}
    }
}

caching {
    type = "redis"
    type = ${?CACHE_TYPE}
    ttl = 3600  # Default TTL in seconds (1 hour)
    ttl = ${?CACHE_TTL}
    maxSize = 1000  # Max entries for memory cache
    maxSize = ${?CACHE_MAX_SIZE}

    redis {
        host = "localhost"
        host = ${?REDIS_HOST}
        port = 6379
        port = ${?REDIS_PORT}
        password = ""
        password = ${?REDIS_PASSWORD}
        database = 0
        database = ${?REDIS_DATABASE}

        pool {
            maxTotal = 8
            maxTotal = ${?REDIS_POOL_MAX_TOTAL}
            maxIdle = 4
            maxIdle = ${?REDIS_POOL_MAX_IDLE}
            minIdle = 0
            minIdle = ${?REDIS_POOL_MIN_IDLE}
            testOnBorrow = true
            testOnBorrow = ${?REDIS_POOL_TEST_ON_BORROW}
        }

        timeout {
            connection = 2000  # milliseconds
            connection = ${?REDIS_TIMEOUT_CONNECTION}
            socket = 2000
            socket = ${?REDIS_TIMEOUT_SOCKET}
            command = 2000
            command = ${?REDIS_TIMEOUT_COMMAND}
        }
    }
}
