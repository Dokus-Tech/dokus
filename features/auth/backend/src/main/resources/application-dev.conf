include "application.conf"

ktor {
    deployment {
        port = 9091
        host = "0.0.0.0"
        environment = "development"
    }
}

database {
    url = "jdbc:postgresql://localhost:5541/auth"
    url = ${?DB_URL}
    username = "dev"
    username = ${?DB_USERNAME}
    password = "dev"
    password = ${?DB_PASSWORD}

    pool {
        maxPoolSize = 5
        minIdle = 2
        idleTimeout = 600000
        maxLifetime = 1800000
    }
}

jwt {
    secret = "dev-secret-key-change-in-production"
    secret = ${?JWT_SECRET}
    issuer = "http://localhost:9091"
    audience = "dokus-api-dev"
    realm = "Dokus Authentication Dev"
}

security {
    cors {
        allowedHosts = ["localhost:5173", "localhost:8080", "localhost:8081", "10.13.4.103:8080", "10.13.4.103:8081"]
    }

    apiKeys {
        monitoring = "dev-monitoring-key"
        admin = "dev-admin-key"
        integration = "dev-integration-key"
    }

    requestSigning {
        enabled = false
        secret = "dev-signing-secret"
    }
}

caching {
    type = "redis"  # Set to redis for dev
    type = ${?CACHE_TYPE}  # Override via env

    redis {
        host = "localhost"
        host = ${?REDIS_HOST}
        port = 6379  # Default Redis port
        port = ${?REDIS_PORT}
        password = "devredispass"  # Match docker-compose
        password = ${?REDIS_PASSWORD}
        database = 0  # Default database
        database = ${?REDIS_DATABASE}

        pool {
            maxTotal = 10
            maxIdle = 5
            minIdle = 1
            testOnBorrow = true
        }

        timeout {
            connection = 2000  # 2 seconds
            socket = 2000
            command = 2000
        }
    }

    # General cache settings
    maxSize = 10000  # Only applies to memory cache
    ttl = 900  # 15 minutes - general cache TTL
}

logging {
    level = "DEBUG"
    console = true
    file = false
}

monitoring {
    metrics {
        enabled = true
        path = "/metrics"
    }

    health {
        enabled = true
        readyPath = "/health/ready"
        livePath = "/health/live"
    }
}

flyway {
    enabled = true
    cleanDisabled = false
    baselineOnMigrate = true
}